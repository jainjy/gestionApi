generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_DATABASE_URL")
  relationMode = "prisma"
}

model BlogArticle {
  id          String    @id @default(uuid())
  authorId    String
  title       String
  slug        String    @unique
  content     String
  excerpt     String?
  coverUrl    String?
  tags        String[]
  status      String    @default("draft")
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())
  category    String
  comments    Int       @default(0)
  likes       Int       @default(0)
  readTime    String?
  views       Int       @default(0)
  author      User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

model User {
  id                String               @id @default(uuid())
  email             String               @unique
  passwordHash      String?
  provider          Json?
  firstName         String?
  lastName          String?
  phone             String?
  role              String               @default("user")
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  resetToken        String?
  resetTokenExpiry  DateTime?
  status            String               @default("inactive")
  companyName       String?
  address           String?
  addressComplement String?
  city              String?
  commercialName    String?
  demandType        String?
  latitude          Float?
  longitude         Float?
  siret             String?
  zipCode           String?
  avatar            String?
  userType          String?
  providerId        String?
  providerName      String?
  stripeCustomerId  String?
  blogArticles      BlogArticle[]
  properties        Property[]
  favorites         Favorite[]
  metiers           UtilisateurMetier[]
  services          UtilisateurService[]
  demandesCrees     Demande[]            @relation("DemandeCreePar")
  demandesArtisan   DemandeArtisan[]     @relation("DemandeArtisanUser")
  Product           Product[]
  Transaction       Transaction[]
  Review            Review[]
  Appointment       Appointment[]
  orders            Order[]
}

model Property {
  id              String     @id @default(uuid())
  title           String
  description     String?
  type            String
  status          String
  price           Float?
  surface         Int?
  rooms           Int?
  bedrooms        Int?
  bathrooms       Int?
  address         String?
  city            String
  zipCode         String?
  latitude        Float?
  longitude       Float?
  features        String[]
  images          String[]
  isFeatured      Boolean    @default(false)
  isActive        Boolean    @default(true)
  views           Int        @default(0)
  ownerId         String
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  publishedAt     DateTime?
  energyClass     String?
  expiresAt       DateTime?
  floor           Int?
  hasBalcony      Boolean    @default(false)
  hasElevator     Boolean    @default(false)
  hasGarden       Boolean    @default(false)
  hasParking      Boolean    @default(false)
  hasPool         Boolean    @default(false)
  hasTerrace      Boolean    @default(false)
  listingType     String     @default("sale")
  metaDescription String?
  metaTitle       String?
  slug            String?    @unique
  totalFloors     Int?
  yearBuilt       Int?
  rentType        String?    @default("longue_duree")
  owner           User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  favorites       Favorite[]
  Demande         Demande[]

  @@index([city])
  @@index([type])
  @@index([status])
  @@index([ownerId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([listingType])
  @@index([createdAt])
}

model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

model Product {
  id             String    @id @default(uuid())
  name           String
  slug           String    @unique
  description    String?
  category       String
  subcategory    String?
  price          Float
  comparePrice   Float?
  cost           Float?
  sku            String?
  barcode        String?
  trackQuantity  Boolean   @default(true)
  quantity       Int       @default(0)
  lowStock       Int?      @default(5)
  weight         Float?
  dimensions     Json?
  images         String[]
  status         String    @default("draft")
  featured       Boolean   @default(false)
  visibility     String    @default("public")
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  publishedAt    DateTime?
  userId         String
  User           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
}

model Metier {
  id       Int                 @id @default(autoincrement())
  libelle  String
  services MetierService[]
  users    UtilisateurMetier[]
  demandes Demande[]
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String
  services Service[]
}

model Service {
  id          Int                  @id @default(autoincrement())
  libelle     String
  categoryId  Int?
  description String?
  images      String[]
  duration    Int?
  price       Float?
  category    Category?            @relation(fields: [categoryId], references: [id])
  metiers     MetierService[]
  users       UtilisateurService[]
  demandes    Demande[]
  Review      Review[]
  Appointment Appointment[]
}

model MetierService {
  metierId  Int
  serviceId Int
  metier    Metier  @relation(fields: [metierId], references: [id])
  service   Service @relation(fields: [serviceId], references: [id])

  @@id([metierId, serviceId])
}

model UtilisateurMetier {
  userId   String
  metierId Int
  user     User   @relation(fields: [userId], references: [id])
  metier   Metier @relation(fields: [metierId], references: [id])

  @@id([userId, metierId])
}

model UtilisateurService {
  userId    String
  serviceId Int
  user      User    @relation(fields: [userId], references: [id])
  service   Service @relation(fields: [serviceId], references: [id])

  @@id([userId, serviceId])
}

model Demande {
  id                  Int              @id @default(autoincrement())
  disponibiliteBien   String?
  description         String?
  contactNom          String?
  contactPrenom       String?
  contactEmail        String?
  contactTel          String?
  contactAdresse      String?
  contactAdresseCp    String?
  contactAdresseVille String?
  lieuAdresse         String?
  lieuAdresseCp       String?
  lieuAdresseVille    String?
  optionAssurance     Boolean?         @default(false)
  demandeAcceptee     Boolean?         @default(false)
  nombreArtisans      String?
  createdById         String
  serviceId           Int?
  createdAt           DateTime         @default(now())
  devis               String?
  dateSouhaitee       DateTime?
  heureSouhaitee      String?
  metierId            Int?
  propertyId          String?
  statut              String?
  isRead              Boolean          @default(false)
  createdBy           User             @relation("DemandeCreePar", fields: [createdById], references: [id])
  service             Service?         @relation(fields: [serviceId], references: [id])
  metier              Metier?          @relation(fields: [metierId], references: [id])
  property            Property?        @relation(fields: [propertyId], references: [id])
  artisans            DemandeArtisan[] @relation("DemandeArtisanDemande")
}

model DemandeArtisan {
  userId    String
  demandeId Int
  accepte   Boolean?  @default(false)
  devis     String?
  rdv       DateTime?
  user      User      @relation("DemandeArtisanUser", fields: [userId], references: [id])
  demande   Demande   @relation("DemandeArtisanDemande", fields: [demandeId], references: [id])

  @@id([userId, demandeId])
}

model DemandeHistory {
  id        Int      @id @default(autoincrement())
  demandeId Int
  title     String?
  message   String?
  snapshot  Json?
  createdAt DateTime @default(now())

  @@index([demandeId])
}

model Transaction {
  id            String   @id @default(uuid())
  userId        String?
  provider      String
  providerId    String?
  amount        Float
  currency      String
  status        String
  description   String?
  referenceType String?
  referenceId   String?
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

model Appointment {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int
  date      DateTime
  time      String
  message   String?
  status    String   @default("pending")
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

model Order {
  id              String   @id @default(uuid())
  orderNumber     String   @unique
  userId          String
  items           Json
  totalAmount     Float
  status          String   @default("pending")
  shippingAddress Json?
  paymentMethod   String
  paymentStatus   String   @default("pending")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}
