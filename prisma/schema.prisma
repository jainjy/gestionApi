// schema.prisma - VERSION COMPL√àTE CORRIG√âE
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_DATABASE_URL")
  relationMode = "prisma"
}
//===================
//BLOG ARTICLES
//===================
model BlogArticle {
  id          String                 @id @default(uuid())
  authorId    String
  title       String
  slug        String                 @unique
  content     String
  excerpt     String?
  coverUrl    String?
  tags        String[]
  status      String                 @default("draft")
  publishedAt DateTime?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  category    String
  comments    Int                    @default(0)
  likes       Int                    @default(0)
  readTime    String?
  views       Int                    @default(0)
  embedding   Unsupported("vector")?

  // Relations CORRIG√âES
  author      User                   @relation(name: "BlogArticleAuthor", fields: [authorId], references: [id], onDelete: Cascade)
  articleLikes BlogArticleLike[]     @relation(name: "BlogArticleLikeArticle")
  blogComments BlogComment[]         @relation(name: "BlogCommentArticle")

  @@index([authorId])
  @@index([slug])
}

model BlogArticleLike {
  id         String   @id @default(uuid())
  articleId  String
  userId     String
  createdAt  DateTime @default(now())

  // Relations CORRIG√âES
  article    BlogArticle @relation(name: "BlogArticleLikeArticle", fields: [articleId], references: [id], onDelete: Cascade)
  user       User        @relation(name: "BlogArticleLikeUser", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([articleId, userId])
  @@index([articleId])
  @@index([userId])
}

model BlogComment {
  id         String   @id @default(uuid())
  articleId  String
  userId     String
  content    String
  parentId   String?  // Pour les r√©ponses aux commentaires
  likes      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isEdited   Boolean  @default(false)

  // Relations CORRIG√âES
  article    BlogArticle @relation(name: "BlogCommentArticle", fields: [articleId], references: [id], onDelete: Cascade)
  user       User        @relation(name: "BlogCommentUser", fields: [userId], references: [id], onDelete: Cascade)
  parent     BlogComment? @relation(name: "CommentReplies", fields: [parentId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  replies    BlogComment[] @relation(name: "CommentReplies")
  commentLikes BlogCommentLike[] @relation(name: "BlogCommentLikeComment")

  @@index([articleId])
  @@index([parentId])
  @@index([userId])
}

model BlogCommentLike {
  id         String   @id @default(uuid())
  commentId  String
  userId     String
  createdAt  DateTime @default(now())

  // Relations CORRIG√âES
  comment    BlogComment @relation(name: "BlogCommentLikeComment", fields: [commentId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  user       User        @relation(name: "BlogCommentLikeUser", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([userId])
}

//===================
//UTILISATEUR - VERSION CORRIG√âE
//===================
model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  passwordHash        String?
  provider            Json?
  firstName           String?
  lastName            String?
  phone               String?
  role                String               @default("user")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  resetToken          String?
  resetTokenExpiry    DateTime?
  status              String               @default("active")
  companyName         String?
  address             String?
  addressComplement   String?
  city                String?
  commercialName      String?
  demandType          String?
  latitude            Float?
  longitude           Float?
  siret               String?
  zipCode             String?
  avatar              String?
  userType            String?
  providerId          String?
  providerName        String?
  stripeCustomerId    String?
  DevisClientToUser   String?              @map("_DevisClientToUser")
  DevisProviderToUser String?              @map("_DevisProviderToUser")
  demandesFinancement FinancementDemande[]
  websiteUrl          String?

  // Relations existantes
  blogArticles      BlogArticle[]        @relation("BlogArticleAuthor")
  blogArticleLikes  BlogArticleLike[]    @relation("BlogArticleLikeUser")
  blogComments      BlogComment[]        @relation("BlogCommentUser")
  blogCommentLikes  BlogCommentLike[]    @relation("BlogCommentLikeUser")
  properties                Property[]
  favorites                 Favorite[]
  metiers                   UtilisateurMetier[]
  services                  UtilisateurService[]
  demandesCrees             Demande[]                 @relation("DemandeCreePar")
  demandesArtisan           DemandeArtisan[]          @relation("DemandeArtisanUser")
  Product                   Product[]
  Transaction               Transaction[]
  Review                    Review[]
  Appointment               Appointment[]
  
  // RELATIONS ORDER CORRIG√âES
  ordersClient      Order[] @relation("OrderClient") // Commandes pass√©es en tant que client
  ordersPrestataire Order[] @relation("OrderPrestataire") // Commandes re√ßues en tant que prestataire
  
  messagesEnvoyes           Message[]                 @relation("MessageExpediteur")
  messagesRecus             Message[]                 @relation("MessageReceiver")
  conversationsCrees        Conversation[]            @relation("ConversationCreateur")
  conversationsParticipees  ConversationParticipant[]
  devisRecus                Devis[]                   @relation("DevisClient")
  devisEnvoyes              Devis[]                   @relation("DevisPrestataire")
  subscriptions             Subscription[]
  tourismeBookings          TourismeBooking[]
  advertisements            Advertisement[]
  demandesRecues            Demande[]                 @relation("DemandeArtisanSpecifique")
  activities                UserActivity[]
  preferences               UserPreference[]
  events                    UserEvent[]
  audits                    Audit[]
  notifications             Notification[]
  notificationsProprietaire Notification[]            @relation("UserProprietaireRelation")

  // RELATION POUR PODCAST 
  podcasts             Podcast[] // Podcasts cr√©√©s par l'utilisateur
  videos               Video[] // Vid√©os cr√©√©es par l'utilisateur
  mediaFavorites       UserMediaFavorite[] // Favoris m√©dias de l'utilisateur
  wellBeingStats       WellBeingStats? // Statistiques bien-√™tre
  ProfessionalSettings ProfessionalSettings?
  Document             Document[]
  ContratType          ContratType[]
  DocumentArchive      DocumentArchive[]
  reservationsCours    ReservationCours[]

  // relation pour coursdomicil
  courses            Course[]            @relation("UserCourses")
  investmentRequests InvestmentRequest[]

  tourismes              Tourisme[]
  volsCrees              Flight[]                @relation("PrestataireVol")
  volsReserves           Flight[]                @relation("ReservationVol")
  touristicPlaceBookings TouristicPlaceBooking[]
  flightReservations     ReservationFlight[]     @relation("ReservationVol")

  flightReservationsReceived ReservationFlight[] @relation("PrestataireVolReservation")

  // Nouvelle relation avec FinancementPartenaire
  financementPartenaires FinancementPartenaire[]
  // ======================
  // NOUVELLES RELATIONS POUR ACTIVIT√âS - VERSION CORRIG√âE
  // ======================
  activityBookings  ActivityBooking[]
  activityFavorites ActivityFavorite[]
  activityShares    ActivityShare[]
  activityReviews   ActivityReview[]
  activityGuide     ActivityGuide?
  guideContacts     GuideContact[] // AJOUT: Relation manquante

  servicesCrees     Service[]  // ‚úÖ AJOUT: Relation avec les services cr√©√©s par le professionnel

  @@index([userType]) // Pour filtrer facilement les professionnels
  @@index([email])
  @@index([role])
  @@index([status])
}


// ======================
// PARAM√àTRES PROFESSIONNELS
// ======================
model ProfessionalSettings {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  horairesLundi           Json?
  horairesMardi           Json?
  horairesMercredi        Json?
  horairesJeudi           Json?
  horairesVendredi        Json?
  horairesSamedi          Json?
  horairesDimanche        Json?
  joursFermes             Json?
  delaiReponseEmail       Int?    @default(24)
  delaiReponseTelephone   Int?    @default(2)
  delaiReponseUrgence     Int?    @default(4)
  delaiAnnulationGratuit  Int?    @default(48)
  fraisAnnulationPourcent Int?    @default(15)
  conditionsAnnulation    String?
  acomptePourcentage      Int?    @default(30)
  montantMinimum          Float?  @default(100)
  conditionsPaiement      String?
  nomEntreprise           String?
  emailContact            String?
  telephone               String?
  adresse                 String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ======================
// üìä ACTIVIT√âS UTILISATEUR
// ======================
model UserActivity {
  id          String   @id @default(cuid())
  userId      String
  entityType  String
  entityId    String
  action      String
  duration    Int?
  searchQuery String?
  metadata    Json?
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([action])
}

// ======================
// ‚ù§Ô∏è PR√âF√âRENCES UTILISATEUR
// ======================
model UserPreference {
  id            String   @id @default(cuid())
  userId        String
  category      String?
  interestScore Float    @default(0.5)
  lastUpdated   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@index([userId])
}

// ======================
// ‚öôÔ∏è √âV√âNEMENTS UTILISATEUR
// ======================
model UserEvent {
  id        String   @id @default(uuid())
  userId    String
  eventType String
  eventData Json?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([eventType])
}

// ======================
// MESSAGES ET CONVERSATIONS
// ======================
model Conversation {
  id        String   @id @default(uuid())
  titre     String?
  demandeId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createurId   String
  createur     User                      @relation("ConversationCreateur", fields: [createurId], references: [id], onDelete: Cascade)
  demande      Demande?                  @relation(fields: [demandeId], references: [id], onDelete: Cascade)
  participants ConversationParticipant[]
  messages     Message[]

  @@index([demandeId])
  @@index([createurId])
}

//===================
//PARTICIPATIONS DE CONVERSATIONS
//===================
model ConversationParticipant {
  id             String    @id @default(uuid())
  conversationId String
  userId         String
  joinedAt       DateTime  @default(now())
  lastReadAt     DateTime? @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

//===================
//MESSAGES DES DEMANDES OU AUTRES
//===================
model Message {
  id             String         @id @default(uuid())
  conversationId String
  expediteurId   String
  receiverId     String?
  contenu        String
  type           MessageType    @default(TEXT)
  urlFichier     String?
  nomFichier     String?
  typeFichier    String?
  evenementType  EvenementType?
  lu             Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  expediteur   User         @relation("MessageExpediteur", fields: [expediteurId], references: [id], onDelete: Cascade)
  receiver     User?        @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([expediteurId])
  @@index([receiverId])
  @@index([createdAt])
  @@index([evenementType])
}

// ======================
// PROPRI√âT√âS
// ======================
model Property {
  id              String                 @id @default(uuid())
  title           String
  description     String?
  type            String
  status          String?
  price           Float?
  surface         Int?
  rooms           Int?
  bedrooms        Int?
  bathrooms       Int?
  address         String?
  city            String
  zipCode         String?
  latitude        Float?
  longitude       Float?
  features        String[]
  images          String[]
  isFeatured      Boolean?               @default(false)
  isActive        Boolean?               @default(true)
  views           Int?                   @default(0)
  ownerId         String
  createdAt       DateTime?              @default(now())
  updatedAt       DateTime?              @updatedAt
  publishedAt     DateTime?
  energyClass     String?
  expiresAt       DateTime?
  floor           Int?
  hasBalcony      Boolean?               @default(false)
  hasElevator     Boolean?               @default(false)
  hasGarden       Boolean?               @default(false)
  hasParking      Boolean?               @default(false)
  hasPool         Boolean?               @default(false)
  hasTerrace      Boolean?               @default(false)
  listingType     String?                @default("sale")
  isPSLA          Boolean?               @default(false)
  isSHLMR          Boolean?               @default(false)
  metaDescription String?
  metaTitle       String?
  slug            String?                @unique
  totalFloors     Int?
  yearBuilt       Int?
  rentType        String?                @default("longue_duree")
  embedding       Unsupported("vector")?

  owner     User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  favorites Favorite[]
  demandes  Demande[]

  @@index([city])
  @@index([type])
  @@index([status])
  @@index([ownerId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([listingType])
  @@index([createdAt])
}

// ======================
// FAVORIS
// ======================
model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

//===================
//LES PRODUITS ALIMENTAIRE ET AUTRES
//===================
model Product {
  id             String                 @id @default(uuid())
  name           String
  slug           String                 @unique
  description    String?
  category       String
  subcategory    String?
  price          Float
  comparePrice   Float?
  cost           Float?
  sku            String?
  barcode        String?
  trackQuantity  Boolean                @default(true)
  quantity       Int                    @default(0)
  lowStock       Int?                   @default(5)
  weight         Float?
  dimensions     Json?
  images         String[]
  status         String                 @default("draft")
  featured       Boolean                @default(false)
  visibility     String                 @default("public")
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  publishedAt    DateTime?
  userId         String
  viewCount      Int                    @default(0)
  clickCount     Int                    @default(0)
  purchaseCount  Int                    @default(0)
  embedding      Unsupported("vector")?
  productType    String?                @default("general")

  allergens       String[]
  brand           String?
  expiryDate      DateTime?
  foodCategory    String?
  isVegan         Boolean?  @default(false)
  isVegetarian    Boolean?  @default(false)
  healthScore     Int?      @default(0) // Score sant√© de 1 √† 10
  isOrganic       Boolean?  @default(false)
  isPerishable    Boolean?  @default(false)
  nutritionalInfo Json?
  origin          String?
  storageTips     String?
  unit            String?

  User User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isVegan])
  @@index([isVegetarian])
  @@index([healthScore])
  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
  @@index([foodCategory])
}

//===================
//LES METIERS
//===================
model Metier {
  id        Int                    @id @default(autoincrement())
  libelle   String
  embedding Unsupported("vector")?
  services  MetierService[]
  users     UtilisateurMetier[]
  demandes  Demande[]
}

// ======================
// CATEGORIE DE SERVICES
// ======================
model Category {
  id       Int       @id @default(autoincrement())
  name     String
  services Service[]
}

//===================
//SERVICES 
//===================
model Service {
  id          Int                    @id @default(autoincrement())
  libelle     String
  categoryId  Int?
  description String?
  images      String[]
  duration    Int?
  price       Float?
  embedding   Unsupported("vector")?
  type        String?   @default("general") //pour facilites le filtres de selection que ce soit art,bien etre ou simplement service
  // Nouveaux champs pour les services personnalis√©s
  createdById String?               // ID du professionnel qui a cr√©√© le service
  isCustom    Boolean   @default(false) // Si c'est un service personnalis√©
  isActive    Boolean   @default(true)  // Si le service est actif
  tags        String[]               // Tags personnalis√©s
  
  category    Category?              @relation(fields: [categoryId], references: [id])
  createdBy   User?                  @relation(fields: [createdById], references: [id], onDelete: Cascade) // Relation avec le cr√©ateur
  metiers     MetierService[]
  users       UtilisateurService[]
  demandes    Demande[]

  Review      Review[]
  Appointment Appointment[]

  @@index([createdById])
  @@index([isCustom])
  @@index([isActive])
}

//===================
//LIAISON METIER ET SERVICE
//===================
model MetierService {
  metierId  Int
  serviceId Int
  metier    Metier  @relation(fields: [metierId], references: [id])
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@id([metierId, serviceId])
}

//===================
//METIER D'UN UTILISATEUR
//===================
model UtilisateurMetier {
  userId   String
  metierId Int
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  metier   Metier @relation(fields: [metierId], references: [id])

  @@id([userId, metierId])
}

//===================
//LES SERVICES LIER A UTILISATEUR
//===================
model UtilisateurService {
  userId    String
  serviceId Int
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  service   Service @relation(fields: [serviceId], references: [id],onDelete: Cascade)
  
  // Nouveaux champs pour personnaliser le service par utilisateur
  customPrice    Float?   // Prix personnalis√© pour ce professionnel
  customDuration Int?     // Dur√©e personnalis√©e
  isAvailable    Boolean  @default(true) // Si le service est disponible
  description    String?  // Description personnalis√©e

  @@id([userId, serviceId])
  @@index([isAvailable])
}

//===================
//DEMANDE
//===================
model Demande {
  id                  Int       @id @default(autoincrement())
  disponibiliteBien   String?
  description         String?
  contactNom          String?
  contactPrenom       String?
  contactEmail        String?
  contactTel          String?
  contactAdresse      String?
  contactAdresseCp    String?
  contactAdresseVille String?
  lieuAdresse         String?
  lieuAdresseCp       String?
  lieuAdresseVille    String?
  optionAssurance     Boolean?  @default(false)
  demandeAcceptee     Boolean?  @default(false)
  nombreArtisans      String?
  createdById         String
  serviceId           Int?
  createdAt           DateTime  @default(now())
  dateSouhaitee       DateTime?
  heureSouhaitee      String?
  metierId            Int?
  propertyId          String?
  statut              String?
  isRead              Boolean   @default(false)
  artisanId           String?

  createdBy     User             @relation("DemandeCreePar", fields: [createdById], references: [id])
  service       Service?         @relation(fields: [serviceId], references: [id])
  metier        Metier?          @relation(fields: [metierId], references: [id])
  property      Property?        @relation(fields: [propertyId], references: [id])
  artisan       User?            @relation("DemandeArtisanSpecifique", fields: [artisanId], references: [id])
  artisans      DemandeArtisan[] @relation("DemandeArtisanDemande")
  conversations Conversation[]
  devis         String?
  devis_demande Devis[]

  @@index([propertyId])
  @@index([createdById])
  @@index([serviceId])
  @@index([statut])
  @@index([createdAt])
  @@index([artisanId])
}

//===================
//DEMANDE DES ARTISAN
//===================
model DemandeArtisan {
  userId           String
  demandeId        Int
  accepte          Boolean?
  devis            String?
  devisFileUrl     String?
  devisFileName    String?
  devisFileType    String?
  rdv              DateTime?
  rdvNotes         String?
  factureFileUrl   String?
  factureFileName  String?
  factureFileType  String?
  factureMontant   Float?
  factureStatus    String?   @default("en_attente")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime? @updatedAt
  travauxTermines  Boolean?  @default(false)
  factureConfirmee Boolean?  @default(false)
  recruited        Boolean?
  user             User      @relation("DemandeArtisanUser", fields: [userId], references: [id])
  demande          Demande   @relation("DemandeArtisanDemande", fields: [demandeId], references: [id])

  @@id([userId, demandeId])
  @@index([userId])
  @@index([demandeId])
  @@index([factureStatus])
}

// ======================
// Historique des demandes
// ======================
model DemandeHistory {
  id        Int      @id @default(autoincrement())
  demandeId Int
  title     String?
  message   String?
  snapshot  Json?
  createdAt DateTime @default(now())

  @@index([demandeId])
}

// ======================
// TRANSACTIONS (PAIEMENTS)
// ======================
model Transaction {
  id             String        @id @default(uuid())
  userId         String?
  subscriptionId String?
  provider       String
  providerId     String?
  amount         Float
  currency       String
  status         String
  description    String?
  referenceType  String?
  referenceId    String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  user           User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([referenceType, referenceId])
}

// ======================
// REVIEW (NOTES)
// ======================
model Review {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int?
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  metadata  Json? // NOUVEAU CHAMP pour stocker les r√©ponses et m√©tadonn√©es
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service   Service? @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

// ======================
// Appointment (RendezVous)
// ======================
model Appointment {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int
  date      DateTime
  time      String
  message   String?
  status    String   @default("pending")
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

// ======================
// COMMANDES
// ======================
model Order {
  id              String   @id @default(uuid())
  orderNumber     String   @unique

  userId          String              // client qui commande
  idPrestataire   String              // propri√©taire du produit/service

  items           Json
  totalAmount     Float
  status          String   @default("pending")
  shippingAddress Json?
  paymentMethod   String
  paymentStatus   String   @default("pending")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations CORRIG√âES - doivent correspondre aux noms dans User
  user        User @relation("OrderClient", fields: [userId], references: [id], onDelete: Cascade)
  prestataire User @relation("OrderPrestataire", fields: [idPrestataire], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([idPrestataire])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

// ======================
// TOURISME
// ======================
model Tourisme {
  id                 String   @id @default(uuid())
  idUnique           String   @unique
  idPrestataire      String
  prestataire        User     @relation(fields: [idPrestataire], references: [id])
  title              String
  type               String
  price              Float
  city               String
  lat                Float
  lng                Float
  rating             Float    @default(0)
  reviewCount        Int      @default(0)
  images             String[]
  amenities          String[]
  maxGuests          Int
  available          Boolean  @default(true)
  provider           String   @default("direct")
  description        String?
  bedrooms           Int?
  bathrooms          Int?
  area               Int?
  instantBook        Boolean  @default(false)
  cancellationPolicy String   @default("moderate")
  featured           Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Nouveaux champs pour lieux touristiques
  isTouristicPlace Boolean @default(false)
  category         String? // monument, museum, park, etc.
  openingHours     String? // "9h-18h, ferm√© le lundi"
  entranceFee      String? // "Gratuit", "10‚Ç¨", "Enfants: 5‚Ç¨"
  website          String?
  contactInfo      String?

  bookings               TourismeBooking[]
  touristicPlaceBookings TouristicPlaceBooking[]
}

// ======================
// NOUVEAU MOD√àLE: DEVIS
// ======================
model Devis {
  id            String   @id @default(uuid())
  numero        String   @unique
  dateCreation  DateTime @default(now())
  dateValidite  DateTime
  montantHT     Float
  montantTTC    Float
  tva           Float
  status        String   @default("en_attente")
  description   String
  conditions    String?
  clientId      String
  prestataireId String
  demandeId     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  client      User     @relation("DevisClient", fields: [clientId], references: [id], onDelete: Cascade)
  prestataire User     @relation("DevisPrestataire", fields: [prestataireId], references: [id], onDelete: Cascade)
  demande     Demande? @relation(fields: [demandeId], references: [id])

  @@index([clientId])
  @@index([prestataireId])
  @@index([demandeId])
  @@index([status])
  @@index([dateCreation])
}

// ======================
// FINANCEMENT DEMANDE
// ======================
model FinancementDemande {
  id           String   @id @default(uuid())
  userId       String?
  nom          String
  email        String
  telephone    String
  message      String
  type         String
  montant      Float?
  duree        Int?
  estimation   Float?
  partenaireId Int?
  assuranceId  Int?
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Nouveaux champs pour les services financiers
  serviceFinancierId String?

  user             User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  partenaire       FinancementPartenaire? @relation(fields: [partenaireId], references: [id])
  assurance        AssuranceService?      @relation(fields: [assuranceId], references: [id])
  serviceFinancier ServiceFinancier?      @relation(fields: [serviceFinancierId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([serviceFinancierId])
}

//type de message
enum MessageType {
  TEXT
  IMAGE
  PDF
  DOCUMENT
  SYSTEM
}

//type d'evenement
enum EvenementType {
  DEMANDE_ENVOYEE
  ARTISAN_ACCEPTE
  ARTISAN_REFUSE
  PROPOSITION_RENDEZ_VOUS
  PROPOSITION_DEVIS
  CLIENT_SIGNE
  RENDEZ_VOUS_FIXE
  FACTURE_ENVOYEE
  FACTURE_PAYEE
  FACTURE_SIGNE
  FACTURE_CONFIRMEE
  FACTURE_REFUSEE
  TRAVAUX_TERMINES
  TRAVAUX_CONFIRMES
  AVIS_LAISSE
  CLIENT_REFUSE
  GENERIC
}

//========================
// Mod√®les pour le financement et assurance
//========================
model FinancementPartenaire {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  rating      Float
  type        String
  avantages   String[]
  icon        String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  // Nouvelle relation avec User (nullable)
  userId           String?
  user             User?              @relation(fields: [userId], references: [id], onDelete: SetNull)
  // Nouveaux champs pour Cr√©dit R√©union
  website          String? // https://creditreunion.com/
  phone            String?
  email            String?
  address          String?
  conditions       String? // Conditions sp√©cifiques du partenaire
  tauxMin          Float? // Taux d'int√©r√™t minimum
  tauxMax          Float? // Taux d'int√©r√™t maximum
  dureeMin         Int? // Dur√©e minimum en mois
  dureeMax         Int? // Dur√©e maximum en mois
  montantMin       Float? // Montant minimum du pr√™t
  montantMax       Float? // Montant maximum du pr√™t
  ServiceFinancier ServiceFinancier[]

  @@index([type])
  @@index([isActive])
  @@index([website])
}

// ======================
// SERVICES FINANCIERS
// ======================
model ServiceFinancier {
  id                   String   @id @default(uuid())
  nom                  String
  description          String
  type                 String // "pret_immobilier", "pret_travaux", "rachat_credit", "assurance_emprunteur"
  categorie            String // "particulier", "professionnel", "entreprise"
  partenaireId         Int
  conditions           String?
  avantages            String[]
  taux                 Float? // Taux d'int√©r√™t annuel
  dureeMin             Int? // Dur√©e minimum en mois
  dureeMax             Int? // Dur√©e maximum en mois
  montantMin           Float? // Montant minimum
  montantMax           Float? // Montant maximum
  fraisDossier         Float? // Frais de dossier
  assuranceObligatoire Boolean  @default(false)
  documentsRequises    String[] // Liste des documents n√©cessaires
  delaiTraitement      String? // "48h", "1 semaine", etc.
  isActive             Boolean  @default(true)
  ordreAffichage       Int      @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Relations
  partenaire         FinancementPartenaire @relation(fields: [partenaireId], references: [id])
  FinancementDemande FinancementDemande[]

  @@index([partenaireId])
  @@index([type])
  @@index([categorie])
  @@index([isActive])
  @@index([ordreAffichage])
}

//===================
//AssuranceService
//===================
model AssuranceService {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  details     String
  icon        String
  obligatoire Boolean              @default(false)
  public      String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  @@index([obligatoire])
  @@index([isActive])
}

// ======================
// TOURISME BOOKING
// ======================
model TourismeBooking {
  id                  String    @id @default(uuid())
  listingId           String
  userId              String?
  checkIn             DateTime
  checkOut            DateTime
  guests              Int
  adults              Int
  children            Int
  infants             Int
  totalAmount         Float
  serviceFee          Float     @default(15.00)
  specialRequests     String?
  paymentMethod       String    @default("card")
  status              String    @default("pending")
  paymentStatus       String    @default("pending")
  stripePaymentIntent String?
  confirmationNumber  String    @unique
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  cancelledAt         DateTime?

  listing Tourisme @relation(fields: [listingId], references: [id], onDelete: Cascade)
  user    User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([listingId])
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
  @@index([confirmationNumber])
}

// ======================
// PUBLICIT√âS
// ======================
model Advertisement {
  id          String    @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  targetUrl   String?
  position    String
  type        String    @default("banner")
  status      String    @default("active")
  startDate   DateTime?
  endDate     DateTime?
  priority    Int       @default(1)
  clicks      Int       @default(0)
  impressions Int       @default(0)
  createdById String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  createdBy User @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([position])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([createdById])
}

// ======================
// PLANS D'ABONNEMENT
// ======================
model SubscriptionPlan {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  price       Float
  interval    String   @default("month")
  features    String[]
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  planType  String
  userTypes String[]
  popular   Boolean  @default(false)
  color     String?
  icon      String?

  subscriptions Subscription[]
}

// ======================
// ABONNEMENTS UTILISATEURS
// ======================
model Subscription {
  id        String    @id @default(uuid())
  userId    String
  planId    Int?
  startDate DateTime  @default(now())
  endDate   DateTime?
  status    String    @default("active")
  autoRenew Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan         SubscriptionPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId])
  @@index([planId])
  @@index([status])
}

// ======================
// PODCASTS
// ======================
model Podcast {
  id           String   @id @default(uuid())
  title        String
  description  String
  audioUrl     String?
  thumbnailUrl String?
  category     String?
  isActive     Boolean  @default(true)
  listens      Int      @default(0)
  duration     String
  fileSize     Int?
  mimeType     String?
  storagePath  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  author            User?               @relation(fields: [authorId], references: [id])
  authorId          String?
  UserMediaFavorite UserMediaFavorite[]

  @@index([authorId])
  @@index([category])
  @@index([isActive])
}

// ======================
// VID√âOS
// ======================
model Video {
  id           String   @id @default(uuid())
  title        String
  description  String
  duration     String
  videoFile    String?
  videoUrl     String?
  thumbnailUrl String?
  category     String?
  authorId     String?
  isPremium    Boolean  @default(false)
  views        Int      @default(0)
  isActive     Boolean  @default(true)
  fileSize     Int?
  mimeType     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  storagePath  String?

  author            User?               @relation(fields: [authorId], references: [id])
  UserMediaFavorite UserMediaFavorite[]

  @@index([authorId])
  @@index([category])
  @@index([isActive])
}

// ======================
// FAVORIS M√âDIAS UTILISATEUR (VERSION CORRIG√âE)
// ======================
model UserMediaFavorite {
  id        String   @id @default(uuid())
  userId    String
  podcastId String?
  videoId   String?
  mediaType String
  createdAt DateTime @default(now())

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  podcast Podcast? @relation(fields: [podcastId], references: [id], onDelete: Cascade)
  video   Video?   @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, podcastId, mediaType])
  @@unique([userId, videoId, mediaType])
  @@index([userId])
  @@index([podcastId])
  @@index([videoId])
  @@index([mediaType])
}

// ======================
// MOD√àLE POUR LES STATISTIQUES BIEN-√äTRE
// ======================
model WellBeingStats {
  id               String    @id @default(uuid())
  userId           String    @unique
  totalSessions    Int       @default(0)
  totalDuration    Int       @default(0)
  favoriteCategory String?
  lastActivityAt   DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

//---------------------
//audit--------
//------------
model Audit {
  id          Int      @id @default(autoincrement())
  titre       String
  description String?
  type        String
  dateAudit   DateTime @default(now())
  responsable String
  statut      String   @default("en cours")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])
}

// Mod√®le pour les documents
model Document {
  id             String    @id @default(uuid())
  nom            String
  type           String
  categorie      String?
  description    String?
  dateExpiration DateTime?
  dateUpload     DateTime  @default(now())
  statut         String    @default("VALIDE")
  taille         String
  format         String
  url            String
  cheminFichier  String
  tags           String[]
  userId         String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([statut])
  @@index([categorie])
  @@index([dateExpiration])
}

// Mod√®le pour les contrats types
model ContratType {
  id                   String   @id @default(uuid())
  nom                  String
  description          String?
  contenu              String
  variables            String[]
  utilise              Int      @default(0)
  derniereModification DateTime @default(now())
  userId               String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Mod√®le pour les archives de documents sign√©s
model DocumentArchive {
  id            String   @id @default(uuid())
  nom           String
  type          String
  dateSignature DateTime
  parties       String[]
  bien          String?
  reference     String   @unique
  url           String
  statut        String   @default("SIGN√â")
  userId        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([dateSignature])
}

//notification 
model Notification {
  id              Int      @id @default(autoincrement())
  type            String
  title           String
  message         String
  relatedEntity   String?
  relatedEntityId String?
  read            Boolean  @default(false)
  createdAt       DateTime @default(now())

  // Utilisateur qui re√ßoit la notification
  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Propri√©taire (nullable)
  userProprietaireId String?
  userProprietaire   User?   @relation("UserProprietaireRelation", fields: [userProprietaireId], references: [id])

  @@index([userId])
  @@index([userProprietaireId])
  @@index([createdAt])
  @@index([read])
  @@index([relatedEntity])
}

// ======================
// COURS √Ä DOMICILE
// ======================
model Course {
  id                String   @id @default(uuid())
  professionalId    String
  category          String
  title             String
  description       String?
  price             Float
  priceUnit         String   @default("session")
  durationMinutes   Int      @default(60)
  maxParticipants   Int      @default(1)
  materialsIncluded Boolean  @default(false)
  level             String   @default("Tous niveaux")
  imageUrl          String?
  documents         Json?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  professional      User                 @relation("UserCourses", fields: [professionalId], references: [id], onDelete: Cascade)
  availabilities    CourseAvailability[]
  reservationsCours ReservationCours[]
}

// ======================
// DISPONIBILIT√âS DES COURS
// ======================
model CourseAvailability {
  id          String  @id @default(uuid())
  courseId    String
  dayOfWeek   Int // 0: Dimanche, 1: Lundi, etc.
  startTime   String // Format: "HH:MM"
  endTime     String // Format: "HH:MM"
  isRecurring Boolean @default(true)

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([dayOfWeek])
}

// ======================
// R√âSERVATIONS DE COURS
// ======================
model ReservationCours {
  id               String            @id @default(cuid())
  courseId         String
  userId           String
  userEmail        String
  userName         String
  date             DateTime
  participants     Int
  totalPrice       Float
  status           StatutReservation @default(en_attente)
  notes            String?
  raisonAnnulation String?

  // Relations
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // M√©tadonn√©es
  professionalId   String
  courseTitle      String
  professionalName String
  courseCategory   String
  courseDuration   Int

  // Timestamps
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  dateAnnulation DateTime?

  @@index([courseId])
  @@index([userId])
  @@index([status])
  @@index([date])
  @@index([professionalId])
  @@map("reservation_cours")
}

enum StatutReservation {
  en_attente
  confirmee
  annulee
  terminee
}

// ======================
// NOUVEAU MOD√àLE: DEMANDES D'INVESTISSEMENT INTERNATIONAL
// ======================
model InvestmentRequest {
  id                  String   @id @default(uuid())
  nom                 String
  email               String
  telephone           String?
  pays_interet        String
  type_investissement String
  budget              String?
  message             String?
  status              String   @default("en_attente")
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  // Relation avec l'utilisateur (optionnelle - pour les utilisateurs connect√©s)
  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([status])
  @@index([created_at])
  @@index([pays_interet])
  @@index([userId])
  @@map("investment_requests")
}

// ======================
// DESTINATIONS RAPPORT 
// ======================
model ReportDestination {
  id        String   @id @default(cuid())
  email     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("report_destinations")
}

//compganie aerrien 

model Flight {
  id String @id @default(uuid())

  // Prestataire (professionnel qui ajoute le vol)
  idPrestataire String
  prestataire   User   @relation("PrestataireVol", fields: [idPrestataire], references: [id])

  compagnie String
  numeroVol String

  departVille     String
  departDateHeure DateTime // ‚úÖ Date + heure de d√©part

  arriveeVille     String
  arriveeDateHeure DateTime // ‚úÖ Date + heure d'arriv√©e

  duree   String
  escales Int
  prix    Float
  classe  String

  services String[] // repas, baggage, wifi...

  image String? // ‚úÖ URL retourn√©e par Supabase

  // R√©servation
  idUser          String?
  userReservation User?               @relation("ReservationVol", fields: [idUser], references: [id])
  reservations    ReservationFlight[]
  nbrPersonne     Int? // nombre de personnes
  place           String? // si√®ge : ex A12, B3...

  createdAt DateTime @default(now())
}

// ======================
// R√âSERVATIONS LIEUX TOURISTIQUES
// ======================
model TouristicPlaceBooking {
  id                  String    @id @default(uuid())
  placeId             String
  userId              String?
  visitDate           DateTime
  visitTime           String
  numberOfTickets     Int
  ticketType          String    @default("adult") // adult, child, student, senior
  totalAmount         Float
  serviceFee          Float     @default(0)
  specialRequests     String?
  paymentMethod       String    @default("card")
  status              String    @default("pending")
  paymentStatus       String    @default("pending")
  stripePaymentIntent String?
  confirmationNumber  String    @unique
  qrCodeUrl           String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  cancelledAt         DateTime?

  // Relations
  place Tourisme @relation(fields: [placeId], references: [id], onDelete: Cascade)
  user  User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([placeId])
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([visitDate])
  @@index([confirmationNumber])
  @@index([createdAt])
}

model ReservationFlight {
  id String @id @default(uuid())

  flightId String
  flight   Flight @relation(fields: [flightId], references: [id])

  // Celui qui r√©serve
  idUser          String
  userReservation User   @relation("ReservationVol", fields: [idUser], references: [id])

  // Propri√©taire du vol
  idPrestataire String
  prestataire   User   @relation("PrestataireVolReservation", fields: [idPrestataire], references: [id])

  nbrPersonne Int
  place       String

  status    String   @default("pending")
  createdAt DateTime @default(now())
}

// ======================
// ACTIVIT√âS ET LOISIRS - NOUVEAUX MOD√àLES
// ======================

// Cat√©gories organis√©es
model ActivityCategory {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  icon        String?
  color       String?
  image       String? 
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  image       String?
  activities Activity[]

  @@index([isActive])
  @@index([sortOrder])
}
// Guides sp√©cialis√©s
model ActivityGuide {
  id             String   @id @default(uuid())
  userId         String   @unique
  bio            String?
  specialties    String[]
  languages      String[]
  experience     Int? // ann√©es d'exp√©rience
  certifications String[]
  rating         Float    @default(0)
  reviewCount    Int      @default(0)
  isVerified     Boolean  @default(false)
  hourlyRate     Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user          User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  activities    Activity[]
  availability  RecurringAvailability[]
  guideContacts GuideContact[]

  @@index([isVerified])
  @@index([rating])
}

// Activit√©s principales
model Activity {
  id              String   @id @default(uuid())
  title           String
  description     String
  categoryId      String
  icon            String?
  image           String
  price           Float?
  duration        String
  level           String
  maxParticipants Int
  minParticipants Int
  location        String?
  latitude        Float?
  longitude       Float?
  meetingPoint    String?
  included        String[]
  requirements    String[]
  highlights      String[]
  status          String   @default("active")
  featured        Boolean  @default(false)
  rating          Float    @default(0)
  reviewCount     Int      @default(0)
  viewCount       Int      @default(0)
  guideId         String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  guide         ActivityGuide          @relation(fields: [guideId], references: [id], onDelete: Cascade)
  category      ActivityCategory       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  bookings      ActivityBooking[]
  reviews       ActivityReview[]
  availability  ActivityAvailability[]
  favorites     ActivityFavorite[]
  shares        ActivityShare[]
  statistics    ActivityStatistics?
  media         ActivityMedia[]
  faqs          ActivityFAQ[]
  promotions    ActivityPromotion[]
  guideContacts GuideContact[]

  @@index([guideId])
  @@index([categoryId])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
}

// M√©dias suppl√©mentaires
model ActivityMedia {
  id         String   @id @default(uuid())
  activityId String
  url        String
  type       String // "image", "video"
  caption    String?
  sortOrder  Int      @default(0)
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([sortOrder])
}

// FAQ dynamique
model ActivityFAQ {
  id         String   @id @default(uuid())
  activityId String
  question   String
  answer     String
  order      Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([isActive])
  @@index([order])
}

// Disponibilit√©s r√©currentes
model RecurringAvailability {
  id        String   @id @default(uuid())
  guideId   String
  dayOfWeek Int // 0: Dimanche, 1: Lundi, etc.
  startTime String // "09:00"
  endTime   String // "18:00"
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  guide ActivityGuide @relation(fields: [guideId], references: [id], onDelete: Cascade)

  @@unique([guideId, dayOfWeek])
  @@index([guideId])
  @@index([dayOfWeek])
}

// Disponibilit√©s sp√©cifiques
model ActivityAvailability {
  id          String   @id @default(uuid())
  activityId  String
  date        DateTime
  startTime   String
  endTime     String
  slots       Int
  bookedSlots Int      @default(0)
  price       Float?
  status      String   @default("available")
  createdAt   DateTime @default(now())

  activity Activity          @relation(fields: [activityId], references: [id], onDelete: Cascade)
  bookings ActivityBooking[]

  @@index([activityId])
  @@index([date])
  @@index([status])
}

// R√©servations
model ActivityBooking {
  id                  String    @id @default(uuid())
  activityId          String
  availabilityId      String
  userId              String
  participants        Int
  totalAmount         Float
  status              String    @default("pending")
  paymentStatus       String    @default("pending")
  paymentMethod       String?
  stripePaymentIntent String?
  specialRequests     String?
  cancellationReason  String?
  bookedAt            DateTime  @default(now())
  cancelledAt         DateTime?
  confirmedAt         DateTime?
  completedAt         DateTime?

  // Relations
  activity     Activity             @relation(fields: [activityId], references: [id], onDelete: Cascade)
  availability ActivityAvailability @relation(fields: [availabilityId], references: [id], onDelete: Cascade)
  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  review       ActivityReview?

  @@index([activityId])
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([bookedAt])
}

// Avis
model ActivityReview {
  id         String   @id @default(uuid())
  activityId String
  bookingId  String   @unique
  userId     String
  rating     Int // 1-5
  comment    String?
  images     String[]
  verified   Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  activity Activity        @relation(fields: [activityId], references: [id], onDelete: Cascade)
  booking  ActivityBooking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([userId])
  @@index([rating])
  @@index([createdAt])
}

// Favoris
model ActivityFavorite {
  id         String   @id @default(uuid())
  activityId String
  userId     String
  createdAt  DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, activityId])
  @@index([userId])
  @@index([activityId])
}

// Partages
model ActivityShare {
  id         String   @id @default(uuid())
  activityId String
  userId     String
  platform   String // facebook, twitter, whatsapp, email, etc.
  sharedWith String? // email ou identifiant de la personne
  createdAt  DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([activityId])
  @@index([platform])
}

// Promotions
model ActivityPromotion {
  id              String   @id @default(uuid())
  activityId      String
  code            String   @unique
  discountType    String // "percentage", "fixed"
  discountValue   Float
  minParticipants Int?
  validFrom       DateTime
  validUntil      DateTime
  usageLimit      Int?
  usedCount       Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([code])
  @@index([isActive])
  @@index([validFrom, validUntil])
}

// Statistiques
model ActivityStatistics {
  id                String   @id @default(uuid())
  activityId        String   @unique
  totalBookings     Int      @default(0)
  completedBookings Int      @default(0)
  cancelledBookings Int      @default(0)
  totalRevenue      Float    @default(0)
  averageRating     Float    @default(0)
  totalShares       Int      @default(0)
  totalFavorites    Int      @default(0)
  lastUpdated       DateTime @default(now())

  activity Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
}

// Contact guides
model GuideContact {
  id          String    @id @default(uuid())
  guideId     String
  userId      String?
  name        String
  email       String
  phone       String?
  message     String
  activityId  String?
  status      String    @default("new")
  respondedAt DateTime?
  createdAt   DateTime  @default(now())

  guide    ActivityGuide @relation(fields: [guideId], references: [id], onDelete: Cascade)
  user     User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  activity Activity?     @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([guideId])
  @@index([userId])
  @@index([activityId])
  @@index([status])
  @@index([createdAt])
}
