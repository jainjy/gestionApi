generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_DATABASE_URL")
  relationMode = "prisma"
}

// ======================
// ENUMS
// ======================
enum MessageType {
  TEXT
  IMAGE
  PDF
  DOCUMENT
  SYSTEM
}

enum EvenementType {
  DEMANDE_ENVOYEE
  ARTISAN_ACCEPTE
  ARTISAN_REFUSE
  PROPOSITION_RENDEZ_VOUS
  PROPOSITION_DEVIS
  CLIENT_SIGNE
  RENDEZ_VOUS_FIXE
  FACTURE_ENVOYEE
  FACTURE_PAYEE
  FACTURE_SIGNE
  FACTURE_CONFIRMEE
  FACTURE_REFUSEE
  TRAVAUX_TERMINES
  TRAVAUX_CONFIRMES
  AVIS_LAISSE
  CLIENT_REFUSE
  GENERIC
}

// ======================
// MODÈLE UTILISATEUR PRINCIPAL
// ======================
model User {
  id                  String                    @id @default(uuid())
  email               String                    @unique
  passwordHash        String?
  provider            Json?
  firstName           String?
  lastName            String?
  phone               String?
  role                String                    @default("user")
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  resetToken          String?
  resetTokenExpiry    DateTime?
  status              String                    @default("inactive")
  companyName         String?
  address             String?
  addressComplement   String?
  city                String?
  commercialName      String?
  demandType          String?
  latitude            Float?
  longitude           Float?
  siret               String?
  zipCode             String?
  avatar              String?
  userType            String?
  providerId          String?
  providerName        String?
  stripeCustomerId    String?
  DevisClientToUser   String?                   @map("_DevisClientToUser")
  DevisProviderToUser String?                   @map("_DevisProviderToUser")

  // Relations
  demandesFinancement      FinancementDemande[]
  blogArticles             BlogArticle[]
  properties               Property[]
  favorites                Favorite[]
  metiers                  UtilisateurMetier[]
  services                 UtilisateurService[]
  demandesCrees            Demande[]                 @relation("DemandeCreePar")
  demandesArtisan          DemandeArtisan[]          @relation("DemandeArtisanUser")
  Product                  Product[]
  Transaction              Transaction[]
  Review                   Review[]
  Appointment              Appointment[]
  orders                   Order[]
  messagesEnvoyes          Message[]                 @relation("MessageExpediteur")
  conversationsCrees       Conversation[]            @relation("ConversationCreateur")
  conversationsParticipees ConversationParticipant[]
  devisRecus               Devis[]                   @relation("DevisClient")
  devisEnvoyes             Devis[]                   @relation("DevisPrestataire")
  subscriptions            Subscription[]
  tourismeBookings         TourismeBooking[]
  advertisements           Advertisement[]
  activities               UserActivity[]
  preferences              UserPreference[]
  events                   UserEvent[]
  podcasts                 Podcast[]
  videos                   Video[]
  mediaFavorites           UserMediaFavorite[]
  wellBeingStats           WellBeingStats?
  professionalSettings     ProfessionalSettings?

  @@index([email])
  @@index([role])
  @@index([status])
}

// ======================
// INTELLIGENCE ARTIFICIELLE & ANALYTIQUE
// ======================
model UserActivity {
  id          String   @id @default(cuid())
  userId      String
  entityType  String
  entityId    String
  action      String
  duration    Int?
  searchQuery String?
  metadata    Json?
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([action])
}

model UserPreference {
  id            String   @id @default(cuid())
  userId        String
  category      String?
  interestScore Float    @default(0.5)
  lastUpdated   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@index([userId])
}

model UserEvent {
  id        String   @id @default(uuid())
  userId    String
  eventType String
  eventData Json?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([eventType])
}

// ======================
// BLOG & CONTENU
// ======================
model BlogArticle {
  id          String   @id @default(uuid())
  authorId    String
  title       String
  slug        String   @unique
  content     String
  excerpt     String?
  coverUrl    String?
  tags        String[]
  status      String   @default("draft")
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  category    String
  comments    Int      @default(0)
  likes       Int      @default(0)
  readTime    String?
  views       Int      @default(0)
  embedding   Unsupported("vector")?

  author User @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

// ======================
// MESSAGERIE & CONVERSATIONS
// ======================
model Conversation {
  id           String                    @id @default(uuid())
  titre        String?
  demandeId    Int?
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  createurId   String
  createur     User                      @relation("ConversationCreateur", fields: [createurId], references: [id], onDelete: Cascade)
  demande      Demande?                  @relation(fields: [demandeId], references: [id], onDelete: Cascade)
  participants ConversationParticipant[]
  messages     Message[]

  @@index([demandeId])
  @@index([createurId])
}

model ConversationParticipant {
  id             String       @id @default(uuid())
  conversationId String
  userId         String
  joinedAt       DateTime     @default(now())
  lastReadAt     DateTime?    @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

model Message {
  id             String         @id @default(uuid())
  conversationId String
  expediteurId   String
  contenu        String
  type           MessageType    @default(TEXT)
  urlFichier     String?
  nomFichier     String?
  typeFichier    String?
  evenementType  EvenementType?
  lu             Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  expediteur   User         @relation("MessageExpediteur", fields: [expediteurId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([expediteurId])
  @@index([createdAt])
  @@index([evenementType])
}

// ======================
// IMMOBILIER
// ======================
model Property {
  id              String   @id @default(uuid())
  title           String
  description     String?
  type            String
  status          String
  price           Float?
  surface         Int?
  rooms           Int?
  bedrooms        Int?
  bathrooms       Int?
  address         String?
  city            String
  zipCode         String?
  latitude        Float?
  longitude       Float?
  features        String[]
  images          String[]
  isFeatured      Boolean  @default(false)
  isActive        Boolean  @default(true)
  views           Int      @default(0)
  ownerId         String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  publishedAt     DateTime?
  energyClass     String?
  expiresAt       DateTime?
  floor           Int?
  hasBalcony      Boolean  @default(false)
  hasElevator     Boolean  @default(false)
  hasGarden       Boolean  @default(false)
  hasParking      Boolean  @default(false)
  hasPool         Boolean  @default(false)
  hasTerrace      Boolean  @default(false)
  listingType     String   @default("sale")
  metaDescription String?
  metaTitle       String?
  slug            String?  @unique
  totalFloors     Int?
  yearBuilt       Int?
  rentType        String?  @default("longue_duree")
  embedding       Unsupported("vector")?

  owner     User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  favorites Favorite[]
  demandes  Demande[]

  @@index([city])
  @@index([type])
  @@index([status])
  @@index([ownerId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([listingType])
  @@index([createdAt])
}

model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

// ======================
// E-COMMERCE & PRODUITS
// ======================
model Product {
  id             String   @id @default(uuid())
  name           String
  slug           String   @unique
  description    String?
  category       String
  subcategory    String?
  price          Float
  comparePrice   Float?
  cost           Float?
  sku            String?
  barcode        String?
  trackQuantity  Boolean  @default(true)
  quantity       Int      @default(0)
  lowStock       Int?     @default(5)
  weight         Float?
  dimensions     Json?
  images         String[]
  status         String   @default("draft")
  featured       Boolean  @default(false)
  visibility     String   @default("public")
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  publishedAt    DateTime?
  userId         String
  viewCount      Int      @default(0)
  clickCount     Int      @default(0)
  purchaseCount  Int      @default(0)
  embedding      Unsupported("vector")?

  // Champs alimentation
  allergens       String[]
  brand           String?
  expiryDate      DateTime?
  foodCategory    String?
  isOrganic       Boolean? @default(false)
  isPerishable    Boolean? @default(false)
  nutritionalInfo Json?
  origin          String?
  productType     String?  @default("general")
  storageTips     String?
  unit            String?

  User User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
  @@index([productType])
  @@index([foodCategory])
}

model Order {
  id              String   @id @default(uuid())
  orderNumber     String   @unique
  userId          String
  items           Json
  totalAmount     Float
  status          String   @default("pending")
  shippingAddress Json?
  paymentMethod   String
  paymentStatus   String   @default("pending")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

// ======================
// SERVICES & MÉTIERS
// ======================
model Metier {
  id        Int                    @id @default(autoincrement())
  libelle   String
  embedding Unsupported("vector")?

  services MetierService[]
  users    UtilisateurMetier[]
  demandes Demande[]
}

model Category {
  id       Int       @id @default(autoincrement())
  name     String
  services Service[]
}

model Service {
  id          Int                    @id @default(autoincrement())
  libelle     String
  categoryId  Int?
  description String?
  images      String[]
  duration    Int?
  price       Float?
  embedding   Unsupported("vector")?

  category Category?         @relation(fields: [categoryId], references: [id])
  metiers  MetierService[]
  users    UtilisateurService[]
  demandes Demande[]
  Review   Review[]
  Appointment Appointment[]
}

model MetierService {
  metierId  Int
  serviceId Int

  metier Metier  @relation(fields: [metierId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@id([metierId, serviceId])
}

model UtilisateurMetier {
  userId   String
  metierId Int

  user   User   @relation(fields: [userId], references: [id])
  metier Metier @relation(fields: [metierId], references: [id])

  @@id([userId, metierId])
}

model UtilisateurService {
  userId    String
  serviceId Int

  user    User    @relation(fields: [userId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@id([userId, serviceId])
}

// ======================
// DEMANDES & DEVIS
// ======================
model Demande {
  id                  Int              @id @default(autoincrement())
  disponibiliteBien   String?
  description         String?
  contactNom          String?
  contactPrenom       String?
  contactEmail        String?
  contactTel          String?
  contactAdresse      String?
  contactAdresseCp    String?
  contactAdresseVille String?
  lieuAdresse         String?
  lieuAdresseCp       String?
  lieuAdresseVille    String?
  optionAssurance     Boolean?         @default(false)
  demandeAcceptee     Boolean?         @default(false)
  nombreArtisans      String?
  createdById         String
  serviceId           Int?
  createdAt           DateTime         @default(now())
  dateSouhaitee       DateTime?
  heureSouhaitee      String?
  metierId            Int?
  propertyId          String?
  statut              String?
  isRead              Boolean          @default(false)
  devis               String?

  createdBy     User             @relation("DemandeCreePar", fields: [createdById], references: [id])
  service       Service?         @relation(fields: [serviceId], references: [id])
  metier        Metier?          @relation(fields: [metierId], references: [id])
  property      Property?        @relation(fields: [propertyId], references: [id])
  artisans      DemandeArtisan[] @relation("DemandeArtisanDemande")
  conversations Conversation[]
  devis_demande Devis[]

  @@index([propertyId])
  @@index([createdById])
  @@index([serviceId])
  @@index([statut])
  @@index([createdAt])
}

model DemandeArtisan {
  userId           String
  demandeId        Int
  accepte          Boolean?
  devis            String?
  devisFileUrl     String?
  devisFileName    String?
  devisFileType    String?
  rdv              DateTime?
  rdvNotes         String?
  factureFileUrl   String?
  factureFileName  String?
  factureFileType  String?
  factureMontant   Float?
  factureStatus    String?   @default("en_attente")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime? @updatedAt
  travauxTermines  Boolean?  @default(false)
  factureConfirmee Boolean?  @default(false)
  recruited        Boolean?

  user    User   @relation("DemandeArtisanUser", fields: [userId], references: [id])
  demande Demande @relation("DemandeArtisanDemande", fields: [demandeId], references: [id])

  @@id([userId, demandeId])
  @@index([userId])
  @@index([demandeId])
  @@index([factureStatus])
}

model DemandeHistory {
  id        Int      @id @default(autoincrement())
  demandeId Int
  title     String?
  message   String?
  snapshot  Json?
  createdAt DateTime @default(now())

  @@index([demandeId])
}

model Devis {
  id            String   @id @default(uuid())
  numero        String   @unique
  dateCreation  DateTime @default(now())
  dateValidite  DateTime
  montantHT     Float
  montantTTC    Float
  tva           Float
  status        String   @default("en_attente")
  description   String
  conditions    String?
  clientId      String
  prestataireId String
  demandeId     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  client      User     @relation("DevisClient", fields: [clientId], references: [id], onDelete: Cascade)
  prestataire User     @relation("DevisPrestataire", fields: [prestataireId], references: [id], onDelete: Cascade)
  demande     Demande? @relation(fields: [demandeId], references: [id])

  @@index([clientId])
  @@index([prestataireId])
  @@index([demandeId])
  @@index([status])
  @@index([dateCreation])
}

// ======================
// FINANCEMENT & ASSURANCE
// ======================
model FinancementDemande {
  id           String                 @id @default(uuid())
  userId       String?
  nom          String
  email        String
  telephone    String
  message      String
  type         String
  montant      Float?
  duree        Int?
  estimation   Float?
  partenaireId Int?
  assuranceId  Int?
  status       String                 @default("pending")
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  user       User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  partenaire FinancementPartenaire? @relation(fields: [partenaireId], references: [id])
  assurance  AssuranceService?      @relation(fields: [assuranceId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
}

model FinancementPartenaire {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  rating      Float
  type        String
  avantages   String[]
  icon        String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  @@index([type])
  @@index([isActive])
}

model AssuranceService {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  details     String
  icon        String
  obligatoire Boolean              @default(false)
  public      String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  @@index([obligatoire])
  @@index([isActive])
}

// ======================
// TOURISME
// ======================
model Tourisme {
  id                 String            @id @default(uuid())
  idUnique           String            @unique
  idPrestataire      String            @unique
  title              String
  type               String
  price              Float
  city               String
  lat                Float
  lng                Float
  rating             Float             @default(0)
  reviewCount        Int               @default(0)
  images             String[]
  amenities          String[]
  maxGuests          Int
  available          Boolean           @default(true)
  provider           String            @default("direct")
  description        String?
  bedrooms           Int?
  bathrooms          Int?
  area               Int?
  instantBook        Boolean           @default(false)
  cancellationPolicy String            @default("moderate")
  featured           Boolean           @default(false)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  bookings TourismeBooking[]
}

model TourismeBooking {
  id                  String    @id @default(uuid())
  listingId           String
  userId              String?
  checkIn             DateTime
  checkOut            DateTime
  guests              Int
  adults              Int
  children            Int
  infants             Int
  totalAmount         Float
  serviceFee          Float     @default(15.00)
  specialRequests     String?
  paymentMethod       String    @default("card")
  status              String    @default("pending")
  paymentStatus       String    @default("pending")
  stripePaymentIntent String?
  confirmationNumber  String    @unique
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  cancelledAt         DateTime?

  listing Tourisme @relation(fields: [listingId], references: [id], onDelete: Cascade)
  user    User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([listingId])
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
  @@index([confirmationNumber])
}

// ======================
// PUBLICITÉS
// ======================
model Advertisement {
  id          String    @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  targetUrl   String?
  position    String
  type        String    @default("banner")
  status      String    @default("active")
  startDate   DateTime?
  endDate     DateTime?
  priority    Int       @default(1)
  clicks      Int       @default(0)
  impressions Int       @default(0)
  createdById String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  createdBy User @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([position])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([createdById])
}

// ======================
// ABONNEMENTS
// ======================
model SubscriptionPlan {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  price       Float
  interval    String         @default("month")
  features    String[]
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  planType    String
  userTypes   String[]
  popular     Boolean        @default(false)
  color       String?
  icon        String?

  subscriptions Subscription[]
}

model Subscription {
  id        String            @id @default(uuid())
  userId    String
  planId    Int?
  startDate DateTime          @default(now())
  endDate   DateTime?
  status    String            @default("active")
  autoRenew Boolean           @default(false)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan         SubscriptionPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId])
  @@index([planId])
  @@index([status])
}

// ======================
// MÉDIAS (PODCASTS & VIDÉOS) - SUPABASE
// ======================
model MediaCategory {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  type        String
  description String?
  color       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  podcasts Podcast[]
  videos   Video[]

  @@index([type])
}

model Podcast {
  id          String              @id @default(uuid())
  title       String
  description String
  duration    String
  audioFile   String?
  audioUrl    String?
  imageUrl    String
  fileSize    Int?
  mimeType    String?
  storagePath String?
  categoryId  Int
  authorId    String?
  isPremium   Boolean             @default(false)
  listens     Int                 @default(0)
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  category  MediaCategory       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  author    User?               @relation(fields: [authorId], references: [id], onDelete: Cascade)
  favorites UserMediaFavorite[]

  @@index([categoryId])
  @@index([authorId])
  @@index([createdAt])
  @@index([isActive])
}

model Video {
  id           String              @id @default(uuid())
  title        String
  description  String
  duration     String
  videoFile    String?
  videoUrl     String?
  thumbnailUrl String
  fileSize     Int?
  mimeType     String?
  storagePath  String?
  categoryId   Int
  authorId     String?
  isPremium    Boolean             @default(false)
  views        Int                 @default(0)
  isActive     Boolean             @default(true)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  category  MediaCategory       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  author    User?               @relation(fields: [authorId], references: [id], onDelete: Cascade)
  favorites UserMediaFavorite[]

  @@index([categoryId])
  @@index([authorId])
  @@index([createdAt])
  @@index([isActive])
}

model UserMediaFavorite {
  id        String   @id @default(uuid())
  userId    String
  mediaId   String
  mediaType String
  createdAt DateTime @default(now())

  user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  podcast Podcast? @relation(fields: [mediaId], references: [id], onDelete: Cascade, map: "UserMediaFavorite_podcast_fkey")
  video  Video?    @relation(fields: [mediaId], references: [id], onDelete: Cascade, map: "UserMediaFavorite_video_fkey")

  @@unique([userId, mediaId, mediaType])
  @@index([userId])
  @@index([mediaId, mediaType])
  @@index([createdAt])
}

// ======================
// BIEN-ÊTRE & STATISTIQUES
// ======================
model WellBeingStats {
  id               String    @id @default(uuid())
  userId           String    @unique
  totalSessions    Int       @default(0)
  totalDuration    Int       @default(0)
  favoriteCategory String?
  lastActivityAt   DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ======================
// PARAMÈTRES PROFESSIONNELS
// ======================
model ProfessionalSettings {
  id                      String   @id @default(uuid())
  userId                  String   @unique
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  horairesLundi           Json?
  horairesMardi           Json?
  horairesMercredi        Json?
  horairesJeudi           Json?
  horairesVendredi        Json?
  horairesSamedi          Json?
  horairesDimanche        Json?
  joursFermes             Json?
  delaiReponseEmail       Int?     @default(24)
  delaiReponseTelephone   Int?     @default(2)
  delaiReponseUrgence     Int?     @default(4)
  delaiAnnulationGratuit  Int?     @default(48)
  fraisAnnulationPourcent Int?     @default(15)
  conditionsAnnulation    String?
  acomptePourcentage      Int?     @default(30)
  montantMinimum          Float?   @default(100)
  conditionsPaiement      String?
  nomEntreprise           String?
  emailContact            String?
  telephone               String?
  adresse                 String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ======================
// TRANSACTIONS & PAIEMENTS
// ======================
model Transaction {
  id             String        @id @default(uuid())
  userId         String?
  subscriptionId String?
  provider       String
  providerId     String?
  amount         Float
  currency       String
  status         String
  description    String?
  referenceType  String?
  referenceId    String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([userId])
  @@index([providerId])
  @@index([status])
  @@index([createdAt])
  @@index([referenceType, referenceId])
}

// ======================
// AVIS & RENDEZ-VOUS
// ======================
model Review {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int?
  rating    Int
  comment   String?
  createdAt DateTime @default(now())

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service Service? @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

model Appointment {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int
  date      DateTime
  time      String
  message   String?
  status    String   @default("pending")
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}