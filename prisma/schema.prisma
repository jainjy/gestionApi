generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_DATABASE_URL")
  relationMode = "prisma"
}

//===================
//BLOG ARTICLES
//===================
model BlogArticle {
  id          String                 @id @default(uuid())
  authorId    String
  title       String
  slug        String                 @unique
  content     String
  excerpt     String?
  coverUrl    String?
  tags        String[]
  status      String                 @default("draft")
  publishedAt DateTime?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  category    String
  comments    Int                    @default(0)
  likes       Int                    @default(0)
  readTime    String?
  views       Int                    @default(0)
  embedding   Unsupported("vector")? // CHANGEMENT: vector sans dimension sp√©cifi√©e

  author User @relation(fields: [authorId], references: [id], onDelete: Cascade)
}

//===================
//UTILISATEUR
//===================
model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  passwordHash        String?
  provider            Json?
  firstName           String?
  lastName            String?
  phone               String?
  role                String               @default("user")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  resetToken          String?
  resetTokenExpiry    DateTime?
  status              String               @default("inactive")
  companyName         String?
  address             String? // Adresse postale
  addressComplement   String? // Compl√©ment d'adresse
  city                String? // Ville
  commercialName      String? // Nom commercial
  demandType          String? // agence immobilier,particulier ou syndicat
  latitude            Float?
  longitude           Float?
  siret               String? // Num√©ro SIRET
  zipCode             String? // Code postal
  avatar              String? // Logo ou avatar de l'utilisateur
  userType            String? // PRESTATAIRE | TOURISME | BIEN ETRE | AGENCE | ADMIN |VENDEUR 
  providerId          String? // ex: "117349..."
  providerName        String? // ex: "google"
  stripeCustomerId    String?
  // NOUVELLES COLONNES: Relations pour les devis
  DevisClientToUser   String?              @map("_DevisClientToUser")
  DevisProviderToUser String?              @map("_DevisProviderToUser")
  demandesFinancement FinancementDemande[]

  // Relations existantes
  blogArticles             BlogArticle[]
  properties               Property[]
  favorites                Favorite[]
  metiers                  UtilisateurMetier[]
  services                 UtilisateurService[]
  demandesCrees            Demande[]                 @relation("DemandeCreePar")
  demandesArtisan          DemandeArtisan[]          @relation("DemandeArtisanUser")
  Product                  Product[]
  Transaction              Transaction[]
  Review                   Review[]
  Appointment              Appointment[]
  orders                   Order[]
  messagesEnvoyes          Message[]                 @relation("MessageExpediteur")
  conversationsCrees       Conversation[]            @relation("ConversationCreateur")
  conversationsParticipees ConversationParticipant[]
  devisRecus               Devis[]                   @relation("DevisClient")
  devisEnvoyes             Devis[]                   @relation("DevisPrestataire")
  subscriptions            Subscription[]
  tourismeBookings         TourismeBooking[]
  advertisements           Advertisement[]
  demandesRecues           Demande[]                 @relation("DemandeArtisanSpecifique")
  //relation pour suggetion intelligente 
  activities               UserActivity[]
  preferences              UserPreference[]
  events                   UserEvent[]
   audits              Audit[]  
   notifications        Notification[]

  // RELATION POUR PODCAST 
  podcasts                 Podcast[] // Podcasts cr√©√©s par l'utilisateur
  videos                   Video[] // Vid√©os cr√©√©es par l'utilisateur
  mediaFavorites           UserMediaFavorite[] // Favoris m√©dias de l'utilisateur
  wellBeingStats           WellBeingStats? // Statistiques bien-√™tre
  ProfessionalSettings     ProfessionalSettings?
  Document                 Document[]
  ContratType              ContratType[]
  DocumentArchive          DocumentArchive[]

  @@index([email])
  @@index([role])
  @@index([status])
}

// ======================
// PARAM√àTRES PROFESSIONNELS
// ======================
model ProfessionalSettings {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Horaires d'ouverture
  horairesLundi    Json? // {ouvert: Boolean, debut: String, fin: String}
  horairesMardi    Json?
  horairesMercredi Json?
  horairesJeudi    Json?
  horairesVendredi Json?
  horairesSamedi   Json?
  horairesDimanche Json?

  // Jours ferm√©s exceptionnels
  joursFermes Json? // [{date: String, label: String}]

  // D√©lais de r√©ponse
  delaiReponseEmail     Int? @default(24) // heures
  delaiReponseTelephone Int? @default(2) // heures
  delaiReponseUrgence   Int? @default(4) // heures

  // Politique d'annulation
  delaiAnnulationGratuit  Int?    @default(48) // heures
  fraisAnnulationPourcent Int?    @default(15) // pourcentage
  conditionsAnnulation    String?

  // Seuil de r√©servation
  acomptePourcentage Int?    @default(30) // pourcentage
  montantMinimum     Float?  @default(100) // euros
  conditionsPaiement String?

  // Informations g√©n√©rales
  nomEntreprise String?
  emailContact  String?
  telephone     String?
  adresse       String?

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ======================
// üìä ACTIVIT√âS UTILISATEUR
// ======================
model UserActivity {
  id          String   @id @default(cuid())
  userId      String
  entityType  String // "product", "service", "job", etc.
  entityId    String
  action      String // "view", "click", "purchase", "search", "long_view"
  duration    Int? // Dur√©e en secondes pour les vues longues
  searchQuery String? // Pour les recherches
  metadata    Json?
  createdAt   DateTime @default(now())

  // üîó Relation vers User
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([action])
}

// ======================
// ‚ù§Ô∏è PR√âF√âRENCES UTILISATEUR
// ======================
model UserPreference {
  id            String   @id @default(cuid())
  userId        String
  category      String? // ex: "√©lectrom√©nager", "tourisme", "mode", etc.
  interestScore Float    @default(0.5) // Score entre 0 et 1
  lastUpdated   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@index([userId])
}

// ======================
// ‚öôÔ∏è √âV√âNEMENTS UTILISATEUR
// ======================
model UserEvent {
  id        String   @id @default(uuid())
  userId    String
  eventType String // "search" | "filter" | "scroll" | "hover" | "share"
  eventData Json? // {query: "machine √† laver", duration: 12}
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([eventType])
}

// ======================
// MESSAGES ET CONVERSATIONS
// ======================
model Conversation {
  id        String   @id @default(uuid())
  titre     String?
  demandeId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createurId   String
  createur     User                      @relation("ConversationCreateur", fields: [createurId], references: [id], onDelete: Cascade)
  demande      Demande?                  @relation(fields: [demandeId], references: [id], onDelete: Cascade)
  participants ConversationParticipant[]
  messages     Message[]

  @@index([demandeId])
  @@index([createurId])
}

//===================
//PARTICIPATIONS DE CONVERSATIONS
//===================
model ConversationParticipant {
  id             String    @id @default(uuid())
  conversationId String
  userId         String
  joinedAt       DateTime  @default(now())
  lastReadAt     DateTime? @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
}

//===================
//MESSAGES DES DEMANDES OU AUTRES
//===================
model Message {
  id             String         @id @default(uuid())
  conversationId String
  expediteurId   String
  contenu        String
  type           MessageType    @default(TEXT)
  urlFichier     String?
  nomFichier     String?
  typeFichier    String?
  evenementType  EvenementType?
  lu             Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  // Relations
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  expediteur   User         @relation("MessageExpediteur", fields: [expediteurId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([expediteurId])
  @@index([createdAt])
  @@index([evenementType])
}

// ======================
// PROPRI√âT√âS
// ======================
model Property {
  id              String                 @id @default(uuid())
  title           String
  description     String? // Nullable
  type            String // "house", "apartment", etc.
  status          String? // "draft", "pending", etc.
  price           Float? // Nullable
  surface         Int? // Nullable
  rooms           Int? // Nullable
  bedrooms        Int? // Nullable
  bathrooms       Int? // Nullable
  address         String? // Nullable
  city            String
  zipCode         String? // Nullable
  latitude        Float? // Nullable
  longitude       Float? // Nullable
  features        String[] // ["pool", "garden", ...]
  images          String[] // URLs Supabase
  isFeatured      Boolean?               @default(false)
  isActive        Boolean?               @default(true)
  views           Int?                   @default(0)
  ownerId         String
  createdAt       DateTime?              @default(now())
  updatedAt       DateTime?              @updatedAt
  publishedAt     DateTime? // Nullable
  energyClass     String? // Nullable
  expiresAt       DateTime? // Nullable
  floor           Int? // Nullable
  hasBalcony      Boolean?               @default(false)
  hasElevator     Boolean?               @default(false)
  hasGarden       Boolean?               @default(false)
  hasParking      Boolean?               @default(false)
  hasPool         Boolean?               @default(false)
  hasTerrace      Boolean?               @default(false)
  listingType     String?                @default("sale")
  metaDescription String? // Nullable
  metaTitle       String? // Nullable
  slug            String?                @unique
  totalFloors     Int? // Nullable
  yearBuilt       Int? // Nullable
  rentType        String?                @default("longue_duree")
  embedding       Unsupported("vector")? // Nullable

  // Relations
  owner     User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  favorites Favorite[]
  demandes  Demande[]

  @@index([city])
  @@index([type])
  @@index([status])
  @@index([ownerId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([listingType])
  @@index([createdAt])
}

// ======================
// FAVORIS
// ======================
model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
}

//===================
//LES PRODUITS ALIMENTAIRE ET AUTRES
//===================
model Product {
  id             String                 @id @default(uuid())
  name           String
  slug           String                 @unique
  description    String?
  category       String
  subcategory    String?
  price          Float
  comparePrice   Float?
  cost           Float?
  sku            String?
  barcode        String?
  trackQuantity  Boolean                @default(true)
  quantity       Int                    @default(0)
  lowStock       Int?                   @default(5)
  weight         Float?
  dimensions     Json?
  images         String[]
  status         String                 @default("draft")
  featured       Boolean                @default(false)
  visibility     String                 @default("public")
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  publishedAt    DateTime?
  userId         String
  viewCount      Int                    @default(0)
  clickCount     Int                    @default(0)
  purchaseCount  Int                    @default(0)
  embedding      Unsupported("vector")? // CHANGEMENT: vector sans dimension sp√©cifi√©e

  // CHAMPS POUR ALIMENTATION
  allergens       String[] // ["gluten", "lactose", "nuts", ...]
  brand           String?
  expiryDate      DateTime?
  foodCategory    String? // "fruits", "legumes", "produits-laitiers", etc.
  isOrganic       Boolean?  @default(false)
  isPerishable    Boolean?  @default(false)
  nutritionalInfo Json? // {calories, proteins, carbs, fats, etc.}
  origin          String? // Pays/r√©gion d'origine
  productType     String?   @default("general") // "general" | "food"
  storageTips     String?
  unit            String? // "kg", "pi√®ce", "litre", "barquette"

  // Relations
  User User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
  @@index([productType])
  @@index([foodCategory])
}

//===================
//LES METIERS
//===================
model Metier {
  id        Int                    @id @default(autoincrement())
  libelle   String
  embedding Unsupported("vector")? // CHANGEMENT: vector sans dimension sp√©cifi√©e
  services  MetierService[]
  users     UtilisateurMetier[]
  demandes  Demande[]
}

// ======================
// CATEGORIE DE SERVICES
// ======================
model Category {
  id       Int       @id @default(autoincrement())
  name     String
  services Service[]
}

//===================
//SERVICES 
//===================
model Service {
  id          Int                    @id @default(autoincrement())
  libelle     String
  categoryId  Int?
  description String?
  images      String[]
  duration    Int? // dur√©e en minutes (facultatif)
  price       Float? // prix du service
  embedding   Unsupported("vector")? // CHANGEMENT: vector sans dimension sp√©cifi√©e
  category    Category?              @relation(fields: [categoryId], references: [id])
  metiers     MetierService[]
  users       UtilisateurService[]
  demandes    Demande[]
  Review      Review[]
  Appointment Appointment[]
}

//===================
//LIAISON METIER ET SERVICE
//===================
model MetierService {
  metierId  Int
  serviceId Int
  metier    Metier  @relation(fields: [metierId], references: [id])
  service   Service @relation(fields: [serviceId], references: [id])

  @@id([metierId, serviceId])
}

//===================
//METIER D'UN UTILISATEUR
//===================
model UtilisateurMetier {
  userId   String
  metierId Int
  user     User   @relation(fields: [userId], references: [id])
  metier   Metier @relation(fields: [metierId], references: [id])

  @@id([userId, metierId])
}

//===================
//LES SERVICES LIER A UTILISATEUR
//===================
model UtilisateurService {
  userId    String
  serviceId Int
  user      User    @relation(fields: [userId], references: [id])
  service   Service @relation(fields: [serviceId], references: [id])

  @@id([userId, serviceId])
}

//===================
//DEMANDE
//===================
model Demande {
  id                  Int              @id @default(autoincrement())
  disponibiliteBien   String? // "LIBRE" | "LOUE"
  description         String?
  contactNom          String?
  contactPrenom       String?
  contactEmail        String?
  contactTel          String?
  contactAdresse      String?
  contactAdresseCp    String?
  contactAdresseVille String?
  lieuAdresse         String?
  lieuAdresseCp       String?
  lieuAdresseVille    String?
  optionAssurance     Boolean?         @default(false)
  demandeAcceptee     Boolean?         @default(false)
  nombreArtisans      String? // "UNIQUE" | "MULTIPLE"
  createdById         String
  serviceId           Int?
  createdAt           DateTime         @default(now())
  dateSouhaitee       DateTime?
  heureSouhaitee      String?
  metierId            Int?
  propertyId          String? // R√©f√©rence optionnelle vers Property.id
  statut              String?
  isRead              Boolean          @default(false)
  artisanId           String? // NOUVEAU: ID de l'artisan sp√©cifique pour les demandes directes
  // Relations
  createdBy           User             @relation("DemandeCreePar", fields: [createdById], references: [id])
  service             Service?         @relation(fields: [serviceId], references: [id])
  metier              Metier?          @relation(fields: [metierId], references: [id])
  property            Property?        @relation(fields: [propertyId], references: [id])
  artisan             User?            @relation("DemandeArtisanSpecifique", fields: [artisanId], references: [id]) // NOUVELLE RELATION
  artisans            DemandeArtisan[] @relation("DemandeArtisanDemande")
  conversations       Conversation[]
  devis               String? // au cas ou il y a des demandes de devis
  // NOUVELLE RELATION: Vers les devis
  devis_demande       Devis[]

  @@index([propertyId])
  @@index([createdById])
  @@index([serviceId])
  @@index([statut])
  @@index([createdAt])
  @@index([artisanId]) // NOUVEAU INDEX
}

//===================
//DEMANDE DES ARTISAN
//===================
model DemandeArtisan {
  userId           String
  demandeId        Int
  accepte          Boolean?
  devis            String?
  devisFileUrl     String? // URL du fichier de devis
  devisFileName    String? // Nom du fichier de devis
  devisFileType    String? // Type du fichier de devis
  rdv              DateTime?
  rdvNotes         String? // Notes pour le rendez-vous
  factureFileUrl   String? // URL du fichier de facture
  factureFileName  String? // Nom du fichier de facture
  factureFileType  String? // Type du fichier de facture
  factureMontant   Float? // Montant de la facture
  factureStatus    String?   @default("en_attente") // en_attente, validee,confirmer, refusee
  createdAt        DateTime  @default(now())
  updatedAt        DateTime? @updatedAt
  travauxTermines  Boolean?  @default(false) // Nouveau champ pour suivre l'√©tat des travaux
  factureConfirmee Boolean?  @default(false) // Nouveau champ pour confirmation du paiement par le pro
  recruited        Boolean? //si l'artisan a ete pris pour le demandes de services
  user             User      @relation("DemandeArtisanUser", fields: [userId], references: [id])
  demande          Demande   @relation("DemandeArtisanDemande", fields: [demandeId], references: [id])

  @@id([userId, demandeId])
  @@index([userId])
  @@index([demandeId])
  @@index([factureStatus])
}

// ======================
// Historique des demandes (snapshot lors d'actions comme annulation/suppression)
// ======================
model DemandeHistory {
  id        Int      @id @default(autoincrement())
  demandeId Int
  title     String?
  message   String?
  snapshot  Json?
  createdAt DateTime @default(now())

  @@index([demandeId])
}

// ======================
// TRANSACTIONS (PAIEMENTS)
// ======================
model Transaction {
  id             String        @id @default(uuid())
  userId         String? // l'utilisateur qui paie
  subscriptionId String? // <- nullable si certaines transactions ne concernent pas d‚Äôabonnement
  provider       String // "stripe" | "paypal"
  providerId     String? // ID du paiement Stripe ou PayPal
  amount         Float // Montant pay√©
  currency       String // "usd", "eur", ...
  status         String // "created", "succeeded", "failed", "refunded", ...
  description    String? // description du paiement
  referenceType  String? // "product" | "demande"
  referenceId    String? // id du produit ou de la demande
  metadata       Json? // donn√©es additionnelles (cart, items, etc.)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  user           User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([referenceType, referenceId])
}

// ======================
// REVIEW (NOTES)
// ======================
model Review {
  id        String   @id @default(uuid())
  userId    String
  serviceId Int?
  rating    Int // 1 √† 5
  comment   String?
  createdAt DateTime @default(now())
  metadata  Json?    // NOUVEAU CHAMP pour stocker les r√©ponses et m√©tadonn√©es
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service Service? @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

// ======================
// Appointment (RendezVous)
// ======================
model Appointment {
  id        String   @id @default(uuid())
  userId    String // client
  serviceId Int
  date      DateTime
  time      String
  message   String?
  status    String   @default("pending") // pending, confirmed, cancelled
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

// ======================
// COMMANDES
// ======================
model Order {
  id              String   @id @default(uuid())
  orderNumber     String   @unique
  userId          String
  items           Json // Tableau d'items de la commande
  totalAmount     Float
  status          String   @default("pending") // pending, confirmed, processing, shipped, delivered, cancelled
  shippingAddress Json? // Adresse de livraison
  paymentMethod   String // card, paypal, bank_transfer
  paymentStatus   String   @default("pending") // pending, paid, failed, refunded
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

// ======================
// TOURISME
// ======================
model Tourisme {
  id                 String   @id @default(uuid())
  idUnique           String   @unique
  idPrestataire      String   @unique
  title              String
  type               String // Remplac√© TourismeType
  price              Float
  city               String
  lat                Float
  lng                Float
  rating             Float    @default(0)
  reviewCount        Int      @default(0)
  images             String[]
  amenities          String[]
  maxGuests          Int
  available          Boolean  @default(true)
  provider           String   @default("direct") // Remplac√© ProviderType
  description        String?
  bedrooms           Int?
  bathrooms          Int?
  area               Int?
  instantBook        Boolean  @default(false)
  cancellationPolicy String   @default("moderate") // Remplac√© CancellationPolicy
  featured           Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  bookings TourismeBooking[]
}

// ======================
// NOUVEAU MOD√àLE: DEVIS
// ======================
model Devis {
  id            String   @id @default(uuid())
  numero        String   @unique
  dateCreation  DateTime @default(now())
  dateValidite  DateTime
  montantHT     Float
  montantTTC    Float
  tva           Float
  status        String   @default("en_attente")
  description   String
  conditions    String?
  clientId      String
  prestataireId String
  demandeId     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  client      User     @relation("DevisClient", fields: [clientId], references: [id], onDelete: Cascade)
  prestataire User     @relation("DevisPrestataire", fields: [prestataireId], references: [id], onDelete: Cascade)
  demande     Demande? @relation(fields: [demandeId], references: [id])

  @@index([clientId])
  @@index([prestataireId])
  @@index([demandeId])
  @@index([status])
  @@index([dateCreation])
}

// ======================
// FINANCEMENT DEMANDE
// ======================
model FinancementDemande {
  id           String   @id @default(uuid())
  userId       String?
  nom          String
  email        String
  telephone    String
  message      String
  type         String // "simulation", "assurance", "partenaire", "contact"
  montant      Float?
  duree        Int?
  estimation   Float?
  partenaireId Int?
  assuranceId  Int?
  status       String   @default("pending") // pending, contacted, completed
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user       User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  partenaire FinancementPartenaire? @relation(fields: [partenaireId], references: [id])
  assurance  AssuranceService?      @relation(fields: [assuranceId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
}

//type de message
enum MessageType {
  TEXT
  IMAGE
  PDF
  DOCUMENT
  SYSTEM
}

//type d'evenement
enum EvenementType {
  DEMANDE_ENVOYEE
  ARTISAN_ACCEPTE
  ARTISAN_REFUSE
  PROPOSITION_RENDEZ_VOUS
  PROPOSITION_DEVIS
  CLIENT_SIGNE
  RENDEZ_VOUS_FIXE
  FACTURE_ENVOYEE
  FACTURE_PAYEE
  FACTURE_SIGNE
  FACTURE_CONFIRMEE
  FACTURE_REFUSEE
  TRAVAUX_TERMINES
  TRAVAUX_CONFIRMES
  AVIS_LAISSE
  CLIENT_REFUSE
  GENERIC
}

//========================
// Mod√®les pour le financement et assurance
//========================
model FinancementPartenaire {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  rating      Float
  type        String // "banque", "courtier", "expert"
  avantages   String[]
  icon        String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  @@index([type])
  @@index([isActive])
}

//===================
//AssuranceService
//===================
model AssuranceService {
  id          Int                  @id @default(autoincrement())
  nom         String
  description String
  details     String
  icon        String
  obligatoire Boolean              @default(false)
  public      String
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  demandes    FinancementDemande[]

  @@index([obligatoire])
  @@index([isActive])
}

// ======================
// TOURISME BOOKING
// ======================
model TourismeBooking {
  id                  String    @id @default(uuid())
  listingId           String
  userId              String?
  checkIn             DateTime
  checkOut            DateTime
  guests              Int
  adults              Int
  children            Int
  infants             Int
  totalAmount         Float
  serviceFee          Float     @default(15.00)
  specialRequests     String?
  paymentMethod       String    @default("card")
  status              String    @default("pending") // pending, confirmed, cancelled, completed
  paymentStatus       String    @default("pending") // pending, paid, failed, refunded
  stripePaymentIntent String?
  confirmationNumber  String    @unique
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  cancelledAt         DateTime?

  // Relations
  listing Tourisme @relation(fields: [listingId], references: [id], onDelete: Cascade)
  user    User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([listingId])
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
  @@index([confirmationNumber])
}

// ======================
// PUBLICIT√âS
// ======================
model Advertisement {
  id          String    @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  targetUrl   String?
  position    String // "header", "sidebar", "homepage", "footer"
  type        String    @default("banner") // "banner", "popup", "video"
  status      String    @default("active") // "active", "inactive", "scheduled"
  startDate   DateTime?
  endDate     DateTime?
  priority    Int       @default(1)
  clicks      Int       @default(0)
  impressions Int       @default(0)
  createdById String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  createdBy User @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([position])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([createdById])
}

// ======================
// PLANS D'ABONNEMENT
// ======================
model SubscriptionPlan {
  id          Int      @id @default(autoincrement())
  name        String // "Pro Immobilier Complet", "Prestataires de Services", etc.
  description String?
  price       Float // 139, 39, 49, 19
  interval    String   @default("month")
  features    String[] // Liste des fonctionnalit√©s
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // NOUVEAUX CHAMPS POUR CORRESPONDRE AU FRONTEND
  planType  String // "real_estate", "services", "furniture", "wellness"
  userTypes String[] // ["VENDEUR", "LOUEUR"], ["PRESTATAIRE"], etc.
  popular   Boolean  @default(false)
  color     String? // "blue", "emerald", "purple", "pink"
  icon      String? // Nom de l'ic√¥ne ou emoji

  // Relations
  subscriptions Subscription[]
}

// ======================
// ABONNEMENTS UTILISATEURS
// ======================
model Subscription {
  id        String    @id @default(uuid())
  userId    String
  planId    Int?
  startDate DateTime  @default(now())
  endDate   DateTime?
  status    String    @default("active") // "active", "canceled", "expired", "pending"
  autoRenew Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan         SubscriptionPlan? @relation(fields: [planId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId])
  @@index([planId])
  @@index([status])
}

// ======================
// MOD√àLES POUR LES M√âDIAS (PODCASTS & VID√âOS)
// ======================

// Mod√®le pour les cat√©gories de m√©dias
model MediaCategory {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  type        String // "podcast", "video"
  description String?
  color       String? // Couleur pour le frontend (blue, green, purple, etc.)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  podcasts Podcast[]
  videos   Video[]

  @@index([type])
}

// Modifiez les mod√®les Podcast et Video :

model Podcast {
  id          String   @id @default(uuid())
  title       String
  description String
  duration    String
  audioFile   String? // Chemin du fichier audio
  audioUrl    String? // URL publique pour lecture
  imageUrl    String
  categoryId  Int
  authorId    String?
  storagePath String?
  isPremium   Boolean  @default(false)
  listens     Int      @default(0)
  isActive    Boolean  @default(true)
  fileSize    Int? // Taille en bytes
  mimeType    String? // "audio/mpeg", etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category          MediaCategory       @relation(fields: [categoryId], references: [id])
  author            User?               @relation(fields: [authorId], references: [id])
  UserMediaFavorite UserMediaFavorite[]
}

model Video {
  id           String   @id @default(uuid())
  title        String
  description  String
  duration     String
  videoFile    String? // Chemin du fichier vid√©o
  videoUrl     String? // URL publique pour lecture
  thumbnailUrl String
  categoryId   Int
  authorId     String?
  isPremium    Boolean  @default(false)
  views        Int      @default(0)
  isActive     Boolean  @default(true)
  fileSize     Int? // Taille en bytes
  mimeType     String? // "video/mp4", etc.
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  storagePath  String?

  category          MediaCategory       @relation(fields: [categoryId], references: [id])
  author            User?               @relation(fields: [authorId], references: [id])
  UserMediaFavorite UserMediaFavorite[]
}

// Mod√®le pour les favoris utilisateur
model UserMediaFavorite {
  id        String   @id @default(uuid())
  userId    String
  mediaId   String
  mediaType String // "podcast", "video"
  createdAt DateTime @default(now())

  // Relations
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  podcast Podcast? @relation(fields: [mediaId], references: [id], onDelete: Cascade, map: "UserMediaFavorite_podcast_fkey")
  video   Video?   @relation(fields: [mediaId], references: [id], onDelete: Cascade, map: "UserMediaFavorite_video_fkey")

  @@unique([userId, mediaId, mediaType])
  @@index([userId])
  @@index([mediaId, mediaType])
}

// ======================
// MOD√àLE POUR LES STATISTIQUES BIEN-√äTRE
// ======================
model WellBeingStats {
  id               String    @id @default(uuid())
  userId           String    @unique
  totalSessions    Int       @default(0)
  totalDuration    Int       @default(0) // en minutes
  favoriteCategory String?
  lastActivityAt   DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

//---------------------
//audit--------
//------------
model Audit {
  id          Int      @id @default(autoincrement())
  titre       String
  description String?
  type        String
  dateAudit   DateTime @default(now())
  responsable String
  statut      String   @default("en cours")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relation vers User
  userId String
  user   User   @relation(fields: [userId], references: [id])
}

// Mod√®le pour les documents
model Document {
  id             String    @id @default(uuid())
  nom            String
  type           String // ASSURANCE, DIPLOME, CERTIFICATION, CONTRAT, CGV, ARCHIVE, IMMOBILIER
  categorie      String? // Pour les documents immobiliers
  description    String?
  dateExpiration DateTime?
  dateUpload     DateTime  @default(now())
  statut         String    @default("VALIDE") // VALIDE, EXPIRANT, EXPIRE, EN_ATTENTE
  taille         String
  format         String
  url            String
  cheminFichier  String
  tags           String[]
  userId         String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([statut])
  @@index([categorie])
  @@index([dateExpiration])
}

// Mod√®le pour les contrats types
model ContratType {
  id                   String   @id @default(uuid())
  nom                  String
  description          String?
  contenu              String
  variables            String[]
  utilise              Int      @default(0)
  derniereModification DateTime @default(now())
  userId               String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Mod√®le pour les archives de documents sign√©s
model DocumentArchive {
  id            String   @id @default(uuid())
  nom           String
  type          String
  dateSignature DateTime
  parties       String[]
  bien          String?
  reference     String   @unique
  url           String
  statut        String   @default("SIGN√â")
  userId        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([dateSignature])
}

//notification 

model Notification {
  id              Int      @id @default(autoincrement())
  type            String   // 'info', 'warning', 'success', 'error'
  title           String
  message         String
  relatedEntity   String?  // 'audit', 'user', 'listing', 'service', 'booking', 'financement', 'devis', etc.
  relatedEntityId String?
  read            Boolean  @default(false)
  createdAt       DateTime @default(now())
  
  // Relation vers User
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([read])
  @@index([relatedEntity])
}
